<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Tabletop RPG: Party Adventure!</title>
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <h1>Tabletop RPG: Party Adventure!</h1>

    <!-- Deck Area -->
    <div class="deck">
        <h2>Shared Deck</h2>
        <button id="draw-btn">Draw Card</button>
        <div id="deck-output"></div>
    </div>

    <!-- Map Area -->
    <div class="map">
        <h2>Map</h2>
        <div id="map-nodes"></div>
    </div>

    <!-- Party Boards -->
    <div class="party-board">
        <h2>Player Parties</h2>
        <div class="party" id="player1-party"><strong>Player 1:</strong></div>
        <div class="party" id="player2-party"><strong>Player 2:</strong></div>
        <!-- Add more players if needed -->
    </div>

    <!-- Event/Encounter Area -->
    <div class="event-area">
        <h2>Event / Encounter</h2>
        <div id="event-output"></div>
    </div>

    <!-- Turn Tracker -->
    <div class="turn-tracker">
        <h2>Turn</h2>
        <div id="turn-output">Current Player: Player 1</div>
        <button id="end-turn-btn">End Turn</button>
    </div>

    <!-- Scripts -->
    <script src="js/deckManager.js"></script>
    <script src="js/mapManager.js"></script>
    <script src="js/gameLogic.js"></script>
    <script>
        const gameState = {
            currentPlayer: 1,
            deck: []
        };

        async function initGame() {
            try {
                gameState.deck = await loadDeck('characters');
                renderMap();
                highlightCurrentNode();
                document.getElementById('draw-btn').onclick = null;
                document.getElementById('end-turn-btn').onclick = null;
                document.getElementById('draw-btn').onclick = drawCard;
                document.getElementById('end-turn-btn').onclick = endTurn;
            }
        }

        function drawCard() {
            if (!gameState.deck || gameState.deck.length === 0) {
                document.getElementById('deck-output').innerText = 'Deck is empty!';
                return;
            }
            const idx = Math.floor(Math.random() * gameState.deck.length);
            const card = gameState.deck.splice(idx, 1)[0];
            document.getElementById('deck-output').innerText = `You drew: ${card.name} (${card.type})`;
            const slot = document.getElementById(`player${gameState.currentPlayer}-party`);
            const div = document.createElement('div');
            div.setAttribute('role', 'listitem');
            div.innerText = `${card.name} [${card.type}]`;
            slot.appendChild(div);
        }

        function endTurn() {
            const totalPlayers = 2;
            gameState.currentPlayer = (gameState.currentPlayer % totalPlayers) + 1;
            document.getElementById('turn-output').innerText = `Current Player: Player ${gameState.currentPlayer}`;
        }

        // Expose mapManager functions globally
        function mapTryMove(id) {
            try {
                tryMove(id);
            } catch (error) {
                console.error('Error in mapTryMove:', error);
            }
        }

        window.onload = initGame;
    </script>
</body>

</html>