<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Tabletop RPG: Party Adventure!</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f0f0f0;
            text-align: center;
        }

        .deck,
        .map,
        .party-board,
        .event-area,
        .turn-tracker {
            margin: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }

        .party {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .node {
            display: inline-block;
            margin: 5px;
            padding: 20px;
            background: #ccc;
            border-radius: 5px;
            cursor: pointer;
            user-select: none;
        }
    </style>
</head>

<body>
    <h1>Tabletop RPG: Party Adventure!</h1>

    <!-- Deck Area -->
    <div class="deck">
        <h2>Shared Deck</h2>
        <button id="draw-btn">Draw Card</button>
        <div id="deck-output"></div>
    </div>

    <!-- Map Area -->
    <div class="map">
        <h2>Map</h2>
        <div id="map-nodes"></div>
    </div>

    <!-- Party Boards -->
    <div class="party-board">
        <h2>Player Parties</h2>
        <div class="party" id="player1-party"><strong>Player 1:</strong></div>
        <div class="party" id="player2-party"><strong>Player 2:</strong></div>
        <!-- Add more players if needed -->
    </div>

    <!-- Event/Encounter Area -->
    <div class="event-area">
        <h2>Event / Encounter</h2>
        <div id="event-output"></div>
    </div>

    <!-- Turn Tracker -->
    <div class="turn-tracker">
        <h2>Turn</h2>
        <div id="turn-output">Current Player: Player 1</div>
        <button id="end-turn-btn">End Turn</button>
    </div>

    <!-- Scripts -->
    <script src="js/deckManager.js"></script>
    <script src="js/mapManager.js"></script>
    <script src="js/gameLogic.js"></script>
    <script>
        let currentPlayer = 1;
        let deck = [];

        // Initialize game
        async function initGame() {
            deck = await loadDeck('characters');
            renderMap();
            highlightCurrentNode();
            document.getElementById('draw-btn').onclick = drawCard;
            document.getElementById('end-turn-btn').onclick = endTurn;
        }

        // Draw a character from the shared deck
        function drawCard() {
            if (deck.length === 0) {
                document.getElementById('deck-output').innerText = 'Deck is empty!';
                return;
            }
            const idx = Math.floor(Math.random() * deck.length);
            const card = deck.splice(idx, 1)[0];
            document.getElementById('deck-output').innerText = `You drew: ${card.name} (${card.type})`;
            const slot = document.getElementById(`player${currentPlayer}-party`);
            const div = document.createElement('div');
            div.innerText = `${card.name} [${card.type}]`;
            slot.appendChild(div);
        }

        // End turn and switch player
        function endTurn() {
            currentPlayer = (currentPlayer % 2) + 1; // adjust for number of players
            document.getElementById('turn-output').innerText = `Current Player: Player ${currentPlayer}`;
        }

        // Expose mapManager functions globally
        function mapTryMove(id) { tryMove(id); }

        window.onload = initGame;
    </script>
</body>

</html>